# ä¸€é”®éƒ¨ç½²è„šæœ¬ä½¿ç”¨æŒ‡å—

## å¯ç”¨è„šæœ¬

### 1. å®Œæ•´æ„å»ºå’Œå¯åŠ¨ï¼ˆé¦–æ¬¡ä½¿ç”¨æˆ–æ›´æ–°ä»£ç åï¼‰
```bash
./build_and_start.sh
```
**åŠŸèƒ½ï¼š**
- âœ… æ£€æŸ¥ Docker è¿è¡ŒçŠ¶æ€
- âœ… æ£€æŸ¥ .env é…ç½®æ–‡ä»¶
- âœ… åœæ­¢ç°æœ‰å®¹å™¨
- âœ… æ„å»ºæ‰€æœ‰é•œåƒï¼ˆAPI, Crawler, ETL, Schedulerï¼‰
- âœ… å¯åŠ¨æ‰€æœ‰å®¹å™¨
- âœ… ç­‰å¾…æœåŠ¡å°±ç»ª
- âœ… æ˜¾ç¤ºæœåŠ¡çŠ¶æ€

**é€‚ç”¨åœºæ™¯ï¼š**
- é¦–æ¬¡éƒ¨ç½²
- ä¿®æ”¹äº†ä»£ç ï¼Œéœ€è¦é‡æ–°æ„å»ºé•œåƒ
- æ·»åŠ äº†æ–°çš„ä¾èµ–åŒ…

---

### 2. å¿«é€Ÿå¯åŠ¨ï¼ˆé•œåƒå·²æ„å»ºï¼‰
```bash
./quick_start.sh
```
**åŠŸèƒ½ï¼š**
- ğŸš€ å¿«é€Ÿå¯åŠ¨æ‰€æœ‰å·²æ„å»ºçš„å®¹å™¨
- ğŸ“Š æ˜¾ç¤ºæœåŠ¡çŠ¶æ€

**é€‚ç”¨åœºæ™¯ï¼š**
- åœæ­¢åé‡æ–°å¯åŠ¨
- ç”µè„‘é‡å¯åå¯åŠ¨æœåŠ¡

---

### 3. åœæ­¢æ‰€æœ‰æœåŠ¡
```bash
./stop.sh
```
**åŠŸèƒ½ï¼š**
- ğŸ›‘ åœæ­¢æ‰€æœ‰è¿è¡Œä¸­çš„å®¹å™¨
- ä¿ç•™æ•°æ®å·å’Œé•œåƒ

---

### 4. å®Œå…¨æ¸…ç†å¹¶é‡å»ºï¼ˆâš ï¸ åˆ é™¤æ‰€æœ‰æ•°æ®ï¼‰
```bash
./clean_rebuild.sh
```
**åŠŸèƒ½ï¼š**
- ğŸ—‘ï¸ åœæ­¢å¹¶åˆ é™¤æ‰€æœ‰å®¹å™¨
- ğŸ—‘ï¸ åˆ é™¤æ‰€æœ‰é¡¹ç›®é•œåƒ
- ğŸ—‘ï¸ **åˆ é™¤æ‰€æœ‰æ•°æ®å·ï¼ˆä¼šæ¸…ç©ºæ•°æ®åº“ï¼ï¼‰**
- ğŸ”„ é‡æ–°æ„å»ºæ‰€æœ‰é•œåƒ
- ğŸš€ å¯åŠ¨æ‰€æœ‰æœåŠ¡

**âš ï¸ è­¦å‘Šï¼š**
- æ­¤æ“ä½œä¼š**æ°¸ä¹…åˆ é™¤æ•°æ®åº“ä¸­çš„æ‰€æœ‰è®¢å•æ•°æ®**ï¼
- éœ€è¦**ä¸¤æ¬¡ç¡®è®¤**æ‰èƒ½æ‰§è¡Œï¼ˆè¾“å…¥ 'YES' å’Œ 'DELETE ALL'ï¼‰
- æ‰§è¡Œå‰ä¼šæ˜¾ç¤ºå½“å‰æ•°æ®åº“è®¢å•æ•°é‡
- é€‚åˆï¼šå½»åº•é‡ç½®ç¯å¢ƒã€è§£å†³ä¸¥é‡é—®é¢˜ã€å¼€å‘æµ‹è¯•

**å®‰å…¨æªæ–½ï¼š**
- åŒé‡ç¡®è®¤æœºåˆ¶
- æ˜¾ç¤ºå½“å‰æ•°æ®é‡
- è¯¦ç»†çš„æ“ä½œè¯´æ˜

---

### 5. å¼ºåˆ¶é‡å»ºï¼ˆä¿®æ”¹ä»£ç åï¼‰
```bash
./build_and_start.sh rebuild
```
**åŠŸèƒ½ï¼š**
- ğŸ”„ å¼ºåˆ¶é‡æ–°æ„å»ºæ‰€æœ‰é•œåƒ
- ğŸš€ å¯åŠ¨æœåŠ¡

**é€‚ç”¨åœºæ™¯ï¼š**
- ä¿®æ”¹äº† requirements.txt
- ä¿®æ”¹äº† Dockerfile
- ä»£ç æ›´æ–°åéœ€è¦é‡æ–°æ„å»º

---

### 6. é‡å¯æœåŠ¡ï¼ˆä¸é‡å»ºé•œåƒï¼‰
```bash
./build_and_start.sh restart
```
**åŠŸèƒ½ï¼š**
- ğŸ”„ é‡å¯æ‰€æœ‰å®¹å™¨
- ä¸é‡æ–°æ„å»ºé•œåƒ

**é€‚ç”¨åœºæ™¯ï¼š**
- ä¿®æ”¹äº† .env é…ç½®
- æœåŠ¡å¼‚å¸¸éœ€è¦é‡å¯

---

## ä½¿ç”¨æµç¨‹

### é¦–æ¬¡éƒ¨ç½²
```bash
# 1. æ£€æŸ¥ .env é…ç½®
cat .env

# 2. æ„å»ºå¹¶å¯åŠ¨
./build_and_start.sh

# 3. æŸ¥çœ‹æ—¥å¿—
docker logs -f delivery_api
```

### æ—¥å¸¸ä½¿ç”¨
```bash
# å¯åŠ¨
./quick_start.sh

# åœæ­¢
./stop.sh
```

### ä»£ç æ›´æ–°å
```bash
# åœæ­¢æœåŠ¡
./stop.sh

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
./build_and_start.sh rebuild
```

---

## æœåŠ¡è®¿é—®

### API æœåŠ¡
- **åœ°å€ï¼š** http://localhost:8000
- **æ–‡æ¡£ï¼š** http://localhost:8000/docs
- **å¥åº·æ£€æŸ¥ï¼š** http://localhost:8000/health

### æ•°æ®åº“
- **åœ°å€ï¼š** localhost:5432
- **ç”¨æˆ·åï¼š** delivery_user
- **å¯†ç ï¼š** delivery_pass
- **æ•°æ®åº“ï¼š** delivery_data

### é£ä¹¦æœºå™¨äºº
- **çŠ¶æ€ï¼š** é•¿è¿æ¥è‡ªåŠ¨è¿è¡Œ
- **æµ‹è¯•ï¼š** åœ¨é£ä¹¦ç¾¤ @æœºå™¨äºº å‘é€ "å¸®åŠ©"

---

## å¸¸ç”¨å‘½ä»¤

### æŸ¥çœ‹æ—¥å¿—
```bash
# æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose logs -f

# API æœåŠ¡æ—¥å¿—
docker logs -f delivery_api

# æ•°æ®åº“æ—¥å¿—
docker logs -f delivery_postgres

# è°ƒåº¦å™¨æ—¥å¿—
docker logs -f delivery_scheduler
```

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€
```bash
docker-compose ps
```

### è¿›å…¥å®¹å™¨
```bash
# è¿›å…¥ API å®¹å™¨
docker exec -it delivery_api bash

# è¿›å…¥æ•°æ®åº“å®¹å™¨
docker exec -it delivery_postgres bash
```

### æ•°æ®åº“æ“ä½œ
```bash
# è¿æ¥æ•°æ®åº“
docker exec -it delivery_postgres psql -U delivery_user -d delivery_data

# æŸ¥è¯¢è®¢å•æ•°é‡
docker exec -it delivery_postgres psql -U delivery_user -d delivery_data -c "SELECT COUNT(*) FROM raw_orders;"
```

### æ‰‹åŠ¨è§¦å‘ä»»åŠ¡
```bash
# è§¦å‘çˆ¬è™«
curl -X POST http://localhost:8000/run/crawler \
  -H "Content-Type: application/json" \
  -d '{"store_code":"all","start_date":"2025-12-22"}'

# è§¦å‘ ETL
curl -X POST http://localhost:8000/run/etl
```

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šDocker å¯åŠ¨å¤±è´¥
**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ£€æŸ¥ Docker æ˜¯å¦è¿è¡Œ
docker info

# å¯åŠ¨ Docker Desktop
open -a Docker
```

### é—®é¢˜ï¼šç«¯å£å†²çª
**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :8000
lsof -i :5432

# åœæ­¢å ç”¨ç«¯å£çš„è¿›ç¨‹
kill -9 <PID>
```

### é—®é¢˜ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥
**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
docker logs delivery_postgres

# é‡å¯æ•°æ®åº“
docker restart delivery_postgres
```

### é—®é¢˜ï¼šé£ä¹¦æœºå™¨äººæ— å“åº”
**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æŸ¥çœ‹é•¿è¿æ¥çŠ¶æ€
docker logs delivery_api | grep -E '(connected|ping|pong)'

# æŸ¥çœ‹æ¶ˆæ¯å¤„ç†æ—¥å¿—
docker logs delivery_api | grep -E '(æ”¶åˆ°é£ä¹¦æ¶ˆæ¯|è¯†åˆ«å‘½ä»¤|å‘é€å“åº”)'

# é‡å¯ API
docker restart delivery_api
```

---

## æ€§èƒ½ä¼˜åŒ–

### å‡å°‘é‡å»ºæ—¶é—´
```bash
# ä»…é‡å»º APIï¼ˆæœ€å¸¸ä¿®æ”¹ï¼‰
docker-compose build api && docker-compose up -d api

# ä»…é‡å»º Crawler
docker build -t dataautomaticengine-crawler ./crawler
```

### æ¸…ç†æœªä½¿ç”¨çš„èµ„æº
```bash
# æ¸…ç†æ‚¬æŒ‚é•œåƒ
docker image prune -f

# æ¸…ç†æœªä½¿ç”¨çš„å®¹å™¨
docker container prune -f

# æ¸…ç†æœªä½¿ç”¨çš„ç½‘ç»œ
docker network prune -f
```

---

## å¤‡ä»½ä¸æ¢å¤

### å¤‡ä»½æ•°æ®åº“
```bash
docker exec delivery_postgres pg_dump -U delivery_user delivery_data > backup_$(date +%Y%m%d).sql
```

### æ¢å¤æ•°æ®åº“
```bash
cat backup_20251223.sql | docker exec -i delivery_postgres psql -U delivery_user -d delivery_data
```

---

## ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### å…³é—­è‡ªåŠ¨é‡è½½ï¼ˆæå‡æ€§èƒ½ï¼‰
ä¿®æ”¹ [docker-compose.yaml](docker-compose.yaml)ï¼š
```yaml
api:
  command: uvicorn main:app --host 0.0.0.0 --port 8000
  # ç§»é™¤ --reload é€‰é¡¹
```

### é…ç½®ç¯å¢ƒå˜é‡
ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ç‹¬ç«‹çš„ `.env.prod` æ–‡ä»¶ï¼š
```bash
cp .env .env.prod
# ä¿®æ”¹ .env.prod ä¸­çš„é…ç½®

# ä½¿ç”¨ç”Ÿäº§é…ç½®å¯åŠ¨
docker-compose --env-file .env.prod up -d
```

---

## æ›´å¤šå¸®åŠ©

æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼š
- API æ¶æ„ï¼š[api/MODULE_STRUCTURE.md](api/MODULE_STRUCTURE.md)
- é£ä¹¦æœºå™¨äººé…ç½®ï¼š[api/services/feishu_bot/SETUP_LONG_CONNECTION.md](api/services/feishu_bot/SETUP_LONG_CONNECTION.md)
- é¡¹ç›®ç»“æ„ï¼š[struct.MD](struct.MD)
